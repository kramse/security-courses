\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

\externaldocument{communication-and-network-security-exercises}
\selectlanguage{english}

\begin{document}

\mytitlepage
{6. Wifi Security}
{Communication and Network Security \the\year}


\slide{Goals for today}

\hlkimage{2cm}{thomas-galler-hZ3uF1-z2Qc-unsplash.jpg}

Todays goals:
\begin{list2}
\item Introduce wireless networks
\item Present the common security standards, and some tools used
\item Discuss how to secure wireless best, infrastructure and/or encryption
\end{list2}

Photo by Thomas Galler on Unsplash


\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item Wifi standarder IEEE 802.11
\item Authentication Protocols RADIUS, PAP, CHAP, EAP
\item Port Based Network Access Control IEEE 802.1x
\item Security problems in wireless protocols
\item Security problems in wireless encryption
\item Hacking wireless networks
\end{list2}
\item Exercises
\begin{list2}
\item Wifi scanning, aka wardriving
\item WPA hacking with a short password
\end{list2}
\end{list1}




\slide{Time schedule}

\begin{list2}
\item 17:00 - 18:15\\
Introduction and basics
\item 30min break\\

\item 18:45 - 19:30\\

\item 15min break\\

\item 19:45 -20:30 45min\\
\end{list2}


\slide{Reading Summary}

\begin{quote}
PPA chapter 12, 13 - 60 pages\\
Skim:\\
\link{http://aircrack-ng.org/doku.php?id=cracking_wpa}
\end{quote}


\slide{Reading Summary, continued}

\begin{alltt}\footnotesize

\end{alltt}

\begin{list1}
\item PPA chapter 12: Packet Analysis for Security
\begin{list2}
\item Reconnaissance An attacker’s first step
\item SYN Scan and fingerprinting
\item Traffic Manipulation ARP Cache Poisoning / spoofing
\item  Analyzing traffic from malware, exploit kits and ransomware
\end{list2}
\end{list1}


\slide{Reading Summary, continued}

\begin{alltt}\footnotesize

\end{alltt}

\begin{list1}
\item PPA chapter 13: Wireless Packet Analysis
\begin{list2}
\item Sniffing channels
\item Wireless card modes, Managed, Ad-hoc and Monitor mode
\item 802.11 packet structure
\item Wireless security
\end{list2}
\end{list1}



\slide{Wifi standarder IEEE 802.11}

\begin{list1}
\item 802.11 er arbejdsgruppen under IEEE
\item De mest kendte standarder idag indenfor trådløse teknologier:
\begin{list2}
\item 802.11b 11Mbps versionen
\item 802.11g 54Mbps versionen
\item 802.11n endnu hurtigere
\item 802.11i Security enhancements Robust Security Network RSN
\end{list2}
\item New names soon:\\
Wi-Fi 6 to identify devices that support 802.11ax technology\\
Wi-Fi 5 to identify devices that support 802.11ac technology\\
Wi-Fi 4 to identify devices that support 802.11n technology
\end{list1}

Kilde: \link{http://grouper.ieee.org/groups/802/11/index.html}

\slide{802.11 modes og frekvenser}

\begin{list1}
\item Access point kører typisk i \emph{access point mode} også kaldet
  infrastructure mode\\
  - al trafik går via AP, mest typiske
\item Alternativt kan wireless kort oprette ad-hoc netværk\\
 - hvor trafikken går direkte mellem netkort
\item Frekvenser op til kanal 11 og 12+13 i DK/EU
\item Helst 2 kanaler spring for 802.11b AP der placeres indenfor rækkevidde
\item Helst 4 kanaler spring for 802.11g AP der placeres indenfor rækkevidde
\end{list1}

\slide{Eksempel på netværk med flere AP'er}

\hlkimage{15cm}{images/wireless-multi-ap.pdf}

\slide{Eksempel på netværk med flere AP'er}

\hlkimage{15cm}{images/wireless-multi-ap-2.pdf}


\slide{Wireless Distribution System WDS}

\hlkimage{14cm}{images/wireless-multi-ap-wds.pdf}

\begin{list1}
\item Se også:
\link{http://en.wikipedia.org/wiki/Wireless_Distribution_System}
\end{list1}






\slide{Er trådløse netværk interessante?}


\centerline{\color{titlecolor}\LARGE\bf wireless 802.11}
\hlkimage{3cm}{12065572121317625675no_hope_Wireless_access_point.png}

\begin{list1}
\item Sikkerhedsproblemer i de trådløse netværk er mange
  \begin{list2}
  \item Fra lavt niveau - eksempelvis ARP, 802.11
  \item dårlige sikringsmekanismer - WEP
  \item dårligt udstyr - mange fejl
  \item usikkkerhed om implementering og overvågning
  \end{list2}
\item Trådløst udstyr er blevet meget billigt!
\item Det er et krav fra brugerne - trådløst er lækkert
\end{list1}


\slide{Konsekvenserne}

\hlkimage{8cm}{images/wireless-daekning.pdf}

\begin{list2}
\item Værre end Internetangreb - anonymt
\item Kræver ikke fysisk adgang til lokationer
%\emph{spioneres imod}
\item Konsekvenserne ved sikkerhedsbrud er generelt større
\item Typisk får man direkte LAN eller Internet adgang!
\end{list2}

\slide{Værktøjer}

\hlkimage{15cm}{kali-linux.png}



\begin{list2}
\item Wirelessscanner - Kali og Airodump
\item Wireless Injection - aireplay-ng
\item Aircrack-ng pakken generelt
\item Kali \link{http://www.kali.org/}
\end{list2}



\slide{Konsulentens udstyr wireless, eksempel kort}

\hlkimage{16cm}{TL-WN722N.png}

\begin{list1}
\item Laptop or Netbook, I typically use USB wireless cards\\
{\bf NB: de indbyggede er ofte ringe til wifi pentest - så check før køb ;-)}
\item Access Points - get a small selection for testing
\item Books:
\begin{list2}
\item
Kali Linux Wireless Penetration Testing: Beginner's Guide
Beginner's Guide, Vivek Ramachandran, Cameron Buchanan, March 2015\\
Also checkout his home page \link{http://www.vivekramachandran.com/}
\end{list2}
\end{list1}

\slide{Kali Nethunter}

\hlkimage{13cm}{kali-nethunter.png}

Source: \link{https://www.kali.org/kali-linux-nethunter/}


\slide{Hackerværktøjer}
% måske til reference afsnit?

\begin{list1}
\item Der benyttes en del værktøjer:
\begin{list2}
\item Nmap, Nping - tester porte, godt til firewall admins \link{http://nmap.org}
\item Metasploit Framework gratis på \link{http://www.metasploit.com/}
\item Wireshark avanceret netværkssniffer - \link{http://http://www.wireshark.org/}
\item Kismet \link {http://www.kismetwireless.net/}
%\item Kismac \link{http://kismac-ng.org/}
\item Aircrack-ng set of tools \link{http://www.aircrack-ng.org/}
%\item Bruteforge \link{http://masterzorag.blogspot.com/}
\item Pyrit GPU cracker \link{http://code.google.com/p/pyrit/}
\item Reaver brute force WPS \link{https://code.google.com/p/reaver-wps/}
\end{list2}
\end{list1}




\slide{Typisk brug af 802.11 udstyr}

\hlkimage{15cm}{images/wlan-accesspoint-1.pdf}

\centerline{\hlkbig et access point - forbindes til netværket}

\slide{Basal konfiguration}

\begin{list1}
\item Når man tager fat på udstyr til trådløse netværk opdager man:
\item SSID - nettet skal have et navn
\item frekvens / kanal - man skal vælge en kanal, eller udstyret
  vælger en automatisk
\item der er nogle forskellige metoder til sikkerhed
\end{list1}


\slide{Wireless networking sikkerhed i 802.11}

\hlkimage{8cm}{images/wlan-accesspoint-1.pdf}

\begin{list1}
\item Sikkerheden er baseret på nogle få forudsætninger
  \begin{list2}
  \item SSID - netnavnet
  \item WEP \emph{kryptering} - Wired Equivalent Privacy
  \item WPA kryptering - Wi-Fi Protected Access, SSID indgår i denne!
  \item måske MAC flitrering, kun bestemte kort må tilgå accesspoint
  \end{list2}
\end{list1}


\slide{Forudsætninger}

\begin{list1}
\item Til gengæld er disse forudsætninger ofte ikke tilstrækkelige ...
  \begin{list2}
  \item WEP er nem at knække, lad helt være med at bruge WEP
  \item WPA PSK er baseret på en DELT hemmelighed som alle stationer kender
  \item nøglen ændres sjældent, og det er svært at distribuere en ny
  \end{list2}
\end{list1}

\slide{SSID - netnavnet}

\begin{list1}
\item Service Set Identifier (SSID) - netnavnet
\item 32 ASCII tegn eller 64 hexadecimale cifre
\item Udstyr leveres typisk med et standard netnavn
\begin{list2}
\item Cisco - tsunami
\item Linksys udstyr - linksys
\item Apple Airport, 3Com m.fl. - det er nemt at genkende dem
\end{list2}
\item SSID kaldes også for  network id NWID
\item SSID broadcast - udstyr leveres oftest med broadcast af SSID
\end{list1}


\slide{Hacking eksempel - det er ikke magi}

\hlkimage{12cm}{ethernet-frame-1.pdf}

\begin{list1}
\item MAC filtrering på trådløse netværk - Alle netkort har en MAC fra fabrikken
\item Kun godkendte kort tillades adgang til netværket
\item Netkort tillader at man overskriver denne adresse midlertidigt
\item MAC adressen på kortene er med i alle pakker der sendes
\item MAC adressen er aldrig krypteret, for hvordan skulle pakken så
  nå frem?
\end{list1}


\slide{Myten om MAC filtrering}

\begin{list1}
\item Eksemplet med MAC filtrering er en af de mange myter
\item Hvorfor sker det?
\begin{list2}
\item Marketing - producenterne sætter store mærkater på æskerne
\item Manglende indsigt - forbrugerne kender reelt ikke koncepterne
\item Hvad \emph{er} en MAC adresse egentlig
\item Relativt få har forudsætningerne for at gennemskue dårlig sikkerhed
\end{list2}
\item Løsninger?
\pause
\begin{list2}
\item Udbrede viden om usikre metoder til at sikre data og computere
\item Udbrede viden om sikre metoder til at sikre data og computere
\end{list2}
\end{list1}

\slide{MAC filtrering}

\hlkimage{12cm}{stupid-security.jpg}

%wardriving her
\slide{Demo: wardriving med airodump-ng}

\hlkimage{12cm}{images/macstumbler.png}

\begin{list1}
\item man tager et trådløst netkort og en bærbar computer og noget software:
\begin{list2}
\item Tidligere brugte man diverse "stumbler", som MacStumbler eller Kismet
\item Idag bruger vi Airodump-ng fra Aircrack-ng.org/Kali
  \end{list2}
\end{list1}

\slide{Øvelse: airodump-ng}

\hlkimage{6cm}{exercise}

\begin{list1}
\item Vi afprøver nu airodump-ng
\item Lån eller køb et netkort, hvis jeg har flere
\item Brug dele af guiden\\ \link{http://www.aircrack-ng.org/doku.php?id=simple_wep_crack}
\end{list1}

\exercise{ex:wardriving}


\slide{Resultater af wardriving}

\begin{list1}
\item Hvad opdager man ved wardriving?
\begin{list2}
\item at WEP/WPA IKKE krypterer hele pakken
\item at alle pakker indeholder MAC adressen
\item WPA/WEP nøglen skifter sjældent
\item Mange wireless er fejlkonfigureret på forskellig vis
\end{list2}
\item {\color{red}
Man kan altså lytte med på et netværk med WEP/WPA, \\
genbruge en anden maskines MAC adresse \\
- og måske endda bryde krypteringen.}
\end{list1}

\slide{Storkøbenhavn}

\hlkimage{14cm}{images/20030830-kbh.png}

\slide{Informationsindsamling}

\begin{list1}
\item Det vi har udført er informationsindsamling
\item Indsamlingen kan være aktiv eller passiv indsamling i forhold
  til målet for angrebet
\item passiv kunne være at lytte med på trafik eller søge i databaser
  på Internet
\item aktiv indsamling er eksempelvis at sende ICMP pakker og
  registrere hvad man får af svar
\end{list1}

\slide{Cryptography}


\begin{list1}
\item Cryptography or cryptology is the practice and study of techniques for secure communication
\item Modern cryptography is heavily based on mathematical theory and computer science practice; cryptographic algorithms are designed around computational hardness assumptions, making such algorithms hard to break in practice by any adversary
\item Symmetric-key cryptography refers to encryption methods in which both the sender and receiver share the same key, to ensure confidentiality, example algorithm AES
\item Public-key cryptography (like RSA) uses two related keys, a key pair of a public key and a private key. This allows for easier key exchanges, and can provide confidentiality, and methods for signatures and other services
\end{list1}

Source: \link{https://en.wikipedia.org/wiki/Cryptography}

\slide{Kryptografiske principper}

\begin{list1}
\item Algoritmerne er kendte
\item Nøglerne er hemmelige
\item Nøgler har en vis levetid - de skal skiftes ofte
\item Et successfuldt angreb på en krypto-algoritme er enhver genvej
  som kræver mindre arbejde end en gennemgang af alle nøglerne
\item Nye algoritmer, programmer, protokoller m.v. skal gennemgås nøje!
\item Se evt. Snake Oil Warning Signs:
Encryption Software to Avoid\\
\link{http://www.interhack.net/people/cmcurtin/snake-oil-faq.html}
\end{list1}


\slide{IEEE 802.11 Security fast forward }

\begin{quote}
{\bf In 2001}, a group from the University of California, Berkeley presented a paper describing weaknesses in the 802.11 Wired Equivalent Privacy (WEP) security mechanism defined in the original standard; they were followed by {\bf Fluhrer, Mantin, and Shamir's} paper titled "Weaknesses in the Key Scheduling Algorithm of RC4". Not long after, Adam Stubblefield and AT\&T publicly announced the first {\bf verification of the attack}. In the attack, they were able to intercept transmissions and gain unauthorized access to wireless networks.
\end{quote}
Source: \link{http://en.wikipedia.org/wiki/IEEE_802.11}

\slide{IEEE 802.11 Security fast forward }

\begin{quote}
The IEEE set up a dedicated task group to create a replacement security solution, {\bf 802.11i} (previously this work was handled as part of a broader 802.11e effort to enhance the MAC layer). The Wi-Fi Alliance announced an {\bf interim specification called Wi-Fi Protected Access (WPA)} based on a subset of the then current IEEE 802.11i draft. These started to appear in products in {\bf mid-2003}. {\bf IEEE 802.11i (also known as WPA2)} itself was ratified in {\bf June 2004}, and uses government strength encryption in the {\bf Advanced Encryption Standard AES,} instead of RC4, which was used in WEP. The modern recommended encryption for the home/consumer space is {\bf WPA2 (AES Pre-Shared Key) and for the Enterprise space is WPA2 along with a RADIUS authentication server} (or another type of authentication server) and a strong authentication method such as EAP-TLS.
\end{quote}
Source: \link{http://en.wikipedia.org/wiki/IEEE_802.11}

\slide{IEEE 802.11 Security fast forward }

\begin{quote}
In January 2005, the IEEE set up yet another task group "w" to protect management and broadcast frames, which previously were sent unsecured. Its standard was published in 2009.[24]

In {\bf December 2011}, a security flaw was revealed that affects wireless routers with the {\bf optional Wi-Fi Protected Setup (WPS)} feature. While WPS is not a part of 802.11, {\bf the flaw allows a remote attacker to recover the WPS PIN and, with it, the router's 802.11i password in a few hours}.
\end{quote}

\vskip 2cm
\centerline{WPS WTF?! - det er som om folk bevidst saboterer wireless sikkerhed!}
\vskip 2cm

Source: \link{http://en.wikipedia.org/wiki/IEEE_802.11}




\slide{WEP kryptering}

\begin{list1}
\item WEP \emph{kryptering} - med nøgler der specificeres som tekst
  eller hexadecimale cifre
\item typisk 40-bit, svarende til 5 ASCII tegn eller 10 hexadecimale
  cifre eller 104-bit 13 ASCII tegn eller 26 hexadecimale cifre
\item WEP er baseret på RC4 algoritmen der er en \emph{stream cipher}
  lavet af Ron Rivest for RSA Data Security
\end{list1}


\slide{De første fejl ved WEP}
\begin{list1}
\item Oprindeligt en dårlig implementation i mange Access Points
\item Fejl i krypteringen - rettet i nyere firmware
\item WEP er baseret på en DELT hemmelighed som alle stationer kender
\item Nøglen ændres sjældent, og det er svært at distribuere en ny
\end{list1}

\slide{WEP som sikkerhed}

\hlkimage{6cm}{images/no-wep.pdf}
\begin{list1}
\item WEP bør ikke bruges overhovedet mere
\item WEP er for simpel til et større netværk - eksempelvis 20 brugere
\item Firmaer bør efter min mening bruge andre
  sikkerhedsforanstaltninger
\item Hvordan udelukker man en bestemt bruger?
\end{list1}

\slide{WEP sikkerhed}

\hlkimage{12cm}{images/airsnort.pdf}

\begin{quote}
AirSnort is a wireless LAN (WLAN) tool which recovers encryption
keys. AirSnort operates by passively monitoring transmissions,
computing the encryption key when enough packets have been gathered.
https://github.com/kramse/conference-open-8021x
802.11b, using the Wired Equivalent Protocol (WEP), is crippled with
numerous security flaws. Most damning of these is the weakness
described in " Weaknesses in the Key Scheduling Algorithm of RC4 "
by Scott Fluhrer, Itsik Mantin and Adi Shamir. Adam Stubblefield
was the first to implement this attack, but he has not made his
software public. AirSnort, along with WEPCrack, which was released
about the same time as AirSnort, are the first publicly available
implementaions of this attack.  \link{http://airsnort.shmoo.com/}
\end{quote}

\slide{major cryptographic errors}

\begin{list1}
\item weak keying - 24 bit er allerede kendt - 128-bit = 104 bit i praksis
\item small IV - med kun 24 bit vil hver IV blive genbrugt oftere
\item CRC-32 som integritetscheck er ikke \emph{stærkt} nok
  kryptografisk set
\item Authentication gives pad - giver fuld adgang - hvis der bare
  opdages \emph{encryption pad} for en bestemt IV. Denne IV kan så
  bruges til al fremtidig kommunikation
\end{list1}

{\hlkbig Konklusion: Kryptografi er svært}

\slide{WEP cracking - airodump og aircrack}

\hlkimage{3cm}{images/no-wep.pdf}

\begin{list1}
\item airodump - opsamling af krypterede pakker
\item aircrack - statistisk analyse og forsøg på at finde WEP nøglen
\item Med disse værktøjer er det muligt at knække \emph{128-bit nøgler}!
\item Blandt andet fordi det reelt er 104-bit nøgler \smiley
\item tommelfingerregel - der skal opsamles mange pakker ca. 100.000
  er godt
\item Links:\\
\link{http://www.cr0.net:8040/code/network/aircrack/} aircrack\\
\link{http://www.securityfocus.com/infocus/1814} WEP: Dead Again
\end{list1}


\slide{airodump opsamling}


\begin{alltt}
\hlktiny
   BSSID              CH  MB  ENC  PWR  Packets   LAN IP / # IVs   ESSID

   00:03:93:ED:DD:8D   6  11       209   {\bf 801963                  540180}   wanlan
\end{alltt}

\begin{list1}
\item Når airodump kører opsamles pakkerne
\item Lås airodump fast til een kanal, -c eller --channel
\end{list1}

Startes med airmon og kan skrive til capture filer:

\begin{alltt}
airmon-ng start wlan0
airodump-ng --channel 6 --write testfil wlan0mon
\end{alltt}


\slide{aircrack - WEP cracker}

\begin{alltt}\tiny
   $ aircrack -n 128 -f 2 aftendump-128.cap
                                 aircrack 2.1
   * Got  540196! unique IVs | fudge factor = 2
   * Elapsed time [00:00:22] | tried 12 keys at 32 k/m
   KB    depth   votes
    0    0/  1   CE(  45) A1(  20) 7E(  15) 98(  15) 72(  12) 82(  12)
    1    0/  2   62(  43) 1D(  24) 29(  15) 67(  13) 94(  13) F7(  13)
    2    0/  1   B6( 499) E7(  18) 8F(  15) 14(  13) 1D(  12) E5(  10)
    3    0/  1   4E( 157) EE(  40) 29(  39) 15(  30) 7D(  28) 61(  20)
    4    0/  1   93( 136) B1(  28) 0C(  15) 28(  15) 76(  15) D6(  15)
    5    0/  2   E1(  75) CC(  45) 39(  31) 3B(  30) 4F(  16) 49(  13)
    6    0/  2   3B(  65) 51(  42) 2D(  24) 14(  21) 5E(  15) FC(  15)
    7    0/  2   6A( 144) 0C(  96) CF(  34) 14(  33) 16(  33) 18(  27)
    8    0/  1   3A( 152) 73(  41) 97(  35) 57(  28) 5A(  27) 9D(  27)
    9    0/  1   F1(  93) 2D(  45) 51(  29) 57(  27) 59(  27) 16(  26)
   10    2/  3   5B(  40) 53(  30) 59(  24) 2D(  15) 67(  15) 71(  12)
   11    0/  2   F5(  53) C6(  51) F0(  21) FB(  21) 17(  15) 77(  15)
   12    0/  2   E6(  88) F7(  81) D3(  36) E2(  32) E1(  29) D8(  27)
         {\color{red}\bf KEY FOUND! [ CE62B64E93E13B6A3AF15BF5E6 ]}
\end{alltt}
%$


\slide{Hvor lang tid tager det?}

\begin{list1}
\item Opsamling a data - ca. en halv time på 802.11b ved optimale forhold
\item Tiden for kørsel af aircrack fra auditor CD
på en Dell CPi 366MHz Pentium II laptop:
\end{list1}
\begin{alltt}
   $ time aircrack -n 128 -f 2 aftendump-128.cap
   ...
   real    5m44.180s   user  0m5.902s     sys  1m42.745s
   \end{alltt}
   %$
\pause
\begin{list1}
\item Tiden for kørsel af aircrack på en VIA CL-10000 1GHz CPU med
  almindelig disk OpenBSD:
\end{list1}
\begin{alltt}
   25.12s real     0.63s user     2.14s system
\end{alltt}


\centerline{\bf For 10 år siden :-P }

\slide{Erstatning for WEP- WPA}

\begin{list1}
\item Det anbefales at bruge:
%\begin{list2}
\item Kendte VPN teknologier eller WPA
\item baseret på troværdige algoritmer
\item implementeret i professionelt udstyr
\item fra troværdige leverandører
\item udstyr der vedligeholdes og opdateres
%\end{list2}
\item Man kan måske endda bruge de eksisterende løsninger - fra
  hjemmepc adgang, mobil adgang m.v.
\end{list1}




\slide{Erstatninger for WEP}
\begin{list1}
\item Der findes idag andre metoder til sikring af trådløse netværk
\item 802.1x Port Based Network Access Control
\item WPA - Wi-Fi Protected Access)\\
WPA = 802.1X + EAP + TKIP + MIC
\item nu WPA2
\begin{quote}
WPA2 is based on the final IEEE 802.11i amendment to the 802.11
standard and is eligible for FIPS 140-2 compliance.
\end{quote}
\item Kilde:
\href{http://www.wifialliance.org/OpenSection/protected_access.asp}
{http://www.wifialliance.org/OpenSection/protected\_access.asp}
\end{list1}

\slide{IEEE 802.1x  Port Based Network Access Control}

\hlkimage{9cm}{osx-8021x.png}

\begin{list2}
\item Nogle switche tillader at man benytter 802.1x
\item Denne protokol sikrer at man valideres før der gives adgang til porten
\item Når systemet skal have adgang til porten afleveres brugernavn og kodeord/certifikat
\item Denne protokol indgår også i WPA Enterprise
\end{list2}


\slide{802.1x og andre teknologier}

\begin{list1}
\item 802.1x i forhold til MAC filtrering giver væsentlige fordele
\item MAC filtrering kan spoofes, hvor 802.1x kræver det rigtige kodeord
\item Typisk benyttes RADIUS og 802.1x integrerer således mod både LDAP og Active Directory
\end{list1}




\slide{WPA eller WPA2?}

\begin{quote}
WPA2 is based upon the Institute for Electrical and Electronics
Engineers (IEEE) 802.11i amendment to the 802.11 standard, which was
ratified on July 29, 2004.
\end{quote}

\begin{quote}
Q: How are WPA and WPA2 similar?\\
A: Both WPA and WPA2 offer a high level of assurance for end-users and network
administrators that their data will remain private and access to their
network restricted to authorized users.
Both utilize 802.1X and Extensible Authentication Protocol (EAP) for
authentication. Both have Personal and Enterprise modes of operation
that meet the distinct needs of the two different consumer and
enterprise market segments.

Q: How are WPA and WPA2 different?\\
A: WPA2 provides a {\bf stronger encryption mechanism} through {\bf
  Advanced Encryption Standard (AES)}, which is a requirement for some
corporate and government users.
\end{quote}

\centerline{Kilde: http://www.wifialliance.org WPA2 Q and A}


\slide{WPA Personal eller Enterprise}

\begin{list1}
\item Personal - en delt hemmelighed, preshared key
\item Enterprise - brugere valideres op mod fælles server
\item Hvorfor er det bedre?
\begin{list2}
\item Flere valgmuligheder - passer til store og små
\item WPA skifter den faktiske krypteringsnøgle jævnligt - TKIP
\item Initialisationsvektoren (IV) fordobles 24 til 48 bit
\item Imødekommer alle kendte problemer med WEP!
\item Integrerer godt med andre teknologier - RADIUS

\vskip 1 cm
\item EAP - Extensible Authentication Protocol - individuel autentifikation
\item TKIP - WPA Temporal Key Integrity Protocol - nøgleskift og integritet
\item MIC - Message Integrity Code - Michael, ny algoritme til integritet
\item CCMP - WPA2 AES / Counter Mode CBC-MAC Protocol
\end{list2}
\end{list1}


\slide{Authentication Protocols RADIUS, PAP, CHAP, EAP}

\begin{list2}
\item Used for verifying credentials, typically username and password
\item
Extensible Authentication Protocol EAP\\
\link{https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol}
 \item Challenge-Handshake Authentication Protocol\\
\link{https://en.wikipedia.org/wiki/Challenge-Handshake_Authentication_Protocol}
 \item Password Authentication Protocol\\
\link{https://en.wikipedia.org/wiki/Password_Authentication_Protocol}
\end{list2}


\slide{Remote Authentication Dial-In User Service RADIUS}
\begin{list1}
\item RADIUS er en protokol til autentificering af brugere op mod en
  fælles server
\item Remote Authentication Dial In User Service (RADIUS)
\item RADIUS er beskrevet i RFC-2865
\item RADIUS kan være en fordel i større netværk med
\begin{list2}
\item dial-in
\item administration af netværksudstyr
\item trådløse netværk
\item andre RADIUS kompatible applikationer
\end{list2}
\item \link{https://en.wikipedia.org/wiki/RADIUS}
\end{list1}

Hint: Jeg har publiceret en RADIUS konfiguration der giver WPA Enterprise - med vilkårligt brugernavn og kode!\\
\link{https://github.com/kramse/conference-open-8021x}



\slide{WPA cracking}

\begin{list1}
\item Nu skifter vi så til WPA og alt er vel så godt?
\pause
\item Desværre ikke!
\item Du skal vælge en laaaaang passphrase, ellers kan man sniffe WPA
  handshake når en computer går ind på netværket!
\item Med et handshake kan man med aircrack igen lave off-line
  bruteforce angreb!
  \item Nye angreb gør at man ikke engang behøver et klient handshake, men kan snakke med AP alene!
\end{list1}

\slide{WPA cracking demo}

\begin{list1}
\item Vi konfigurerer AP med Henrik42 som WPA-PSK/passhrase
\item Vi finder netværk kismet eller airodump
\item Vi starter airodump mod specifik kanal
\item Vi spoofer deauth og opsamler WPA handshake
\item Vi knækker WPA :-)
\end{list1}

\centerline{Brug manualsiderne for programmerne i aircrack-ng pakken!}

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
slax ~ # aircrack-ng -w dict wlan-test.cap
Opening wlan-test.cap
Read 1082 packets.

#  BSSID              ESSID           Encryption

1  00:11:24:0C:DF:97  wlan            WPA (1 handshake)
2  00:13:5F:26:68:D0  Noea            No data - WEP or WPA
3  00:13:5F:26:64:80  Noea            No data - WEP or WPA
4  00:00:00:00:00:00                  Unknown

Index number of target network ? {\bf 1}
\end{alltt}

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
          [00:00:00] 0 keys tested (0.00 k/s)

                    KEY FOUND! [ Henrik42 ]

Master Key     : 8E 61 AB A2 C5 25 4D 3F 4B 33 E6 AD 2D 55 6F 76
                 6E 88 AC DA EF A3 DE 30 AF D8 99 DB F5 8F 4D BD
Transcient Key : C5 BB 27 DE EA 34 8F E4 81 E7 AA 52 C7 B4 F4 56
                 F2 FC 30 B4 66 99 26 35 08 52 98 26 AE 49 5E D7
                 9F 28 98 AF 02 CA 29 8A 53 11 EB 24 0C B0 1A 0D
                 64 75 72 BF 8D AA 17 8B 9D 94 A9 31 DC FB 0C ED

EAPOL HMAC     : 27 4E 6D 90 55 8F 0C EB E1 AE C8 93 E6 AC A5 1F

\end{alltt}

\vskip 1 cm

\centerline{Min Thinkpad X31 med 1.6GHz Pentium M knækker ca. 150 Keys/sekund}

\slide{Encryption key length}

\hlkimage{12cm}{encryption-crack.png}
Old, but think about your attackers and their budgets!

Kilde: \link{http://www.mycrypto.net/encryption/encryption_crack.html}



\slide{New attack on WPA/WPA2 using PMKID}


\begin{quote}\small
This attack was discovered accidentally while looking for new ways to attack the new WPA3 security standard. WPA3 will be much harder to attack because of its modern key establishment protocol called "Simultaneous Authentication of Equals" (SAE).

The main difference from existing attacks is that in this attack, capture of a full EAPOL 4-way handshake is not required. The new attack is performed on the RSN IE (Robust Security Network Information Element) of a single EAPOL frame.

At this time, we do not know for which vendors or for how many routers this technique will work, but we think it will work against all 802.11i/p/q/r networks with roaming functions enabled (most modern routers).

The main advantages of this attack are as follow:
No more regular users required - because the attacker directly communicates with the AP (aka "client-less" attack)
No more waiting for a complete 4-way handshake between the regular user and the AP
No more eventual retransmissions of EAPOL frames (which can lead to uncrackable results)
No more eventual invalid passwords sent by the regular user
No more lost EAPOL frames when the regular user or the AP is too far away from the attacker
No more fixing of nonce and replaycounter values required (resulting in slightly higher speeds)
No more special output format (pcap, hccapx, etc.) - final data will appear as regular hex encoded string
\end{quote}

\begin{list2}
\item \link{https://hashcat.net/forum/thread-7717.html} New attack on WPA/WPA2 using PMKID
\item \link{https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/}
\end{list2}

\exercise{ex:aircrack-ng}


\slide{WPA cracking med Pyrit}

\begin{quote}
\emph{Pyrit} takes a step ahead in attacking WPA-PSK and WPA2-PSK, the protocol that today de-facto protects public WIFI-airspace. The project's goal is to estimate the real-world security provided by these protocols. Pyrit does not provide binary files or wordlists and does not encourage anyone to participate or engage in any harmful activity. {\bf This is a research project, not a cracking tool.}

\emph{Pyrit's} implementation allows to create massive databases, pre-computing part of the WPA/WPA2-PSK authentication phase in a space-time-tradeoff. The performance gain for real-world-attacks is in the range of three orders of magnitude which urges for re-consideration of the protocol's security. Exploiting the computational power of GPUs, \emph{Pyrit} is currently by far the most powerful attack against one of the world's most used security-protocols.
\end{quote}

\begin{list1}
\item sloooow, plejede det at være -  ~150 keys/s på min Thinkpad X31
\item Kryptering afhænger af SSID! Så check i tabellen er ~minutter.
\item \link{http://pyrit.wordpress.com/about/}
\end{list1}

\slide{Tired of WoW?}

\hlkimage{17cm}{pyritperfaa3.png}

Kilde: \link{http://code.google.com/p/pyrit/}


\slide{Hashcat Cracking passwords and secrets}

\begin{list2}
\item Hashcat is the world's fastest CPU-based password recovery tool.
\item oclHashcat-plus is a GPGPU-based multi-hash cracker using a brute-force attack (implemented as mask attack), combinator attack, dictionary attack, hybrid attack, mask attack, and rule-based attack.
\item oclHashcat-lite is a GPGPU cracker that is optimized for cracking performance. Therefore, it is limited to only doing single-hash cracking using Markov attack, Brute-Force attack and Mask attack.
\item John the Ripper password cracker old skool men stadig nyttig
\end{list2}

Source:\\
\link{http://hashcat.net/wiki/}\\
\link{http://www.openwall.com/john/}\\
\link{http://hashcat.net/wiki/doku.php?id=cracking_wpawpa2}



\slide{ Wi-Fi Protected Setup, WPS hacking - Reaver}

\begin{quote}
Reaver Open Source
Reaver implements a brute force attack against Wifi Protected Setup (WPS) registrar PINs in order to recover WPA/WPA2 passphrases, as described in \link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}.

Reaver has been designed to be a robust and practical attack against WPS, and has been tested against a wide variety of access points and WPS implementations.

On average Reaver will recover the target AP's plain text WPA/WPA2 passphrase in 4-10 hours, depending on the AP. In practice, it will generally take half this time to guess the correct WPS pin and recover the passphrase.
\end{quote}

\centerline{Hvad betyder ease of use?}

Source: \\
\link{https://code.google.com/p/reaver-wps/}\\
{\footnotesize \link{http://lifehacker.com/5873407/how-to-crack-a-wi+fi-networks-wpa-password-with-reaver}}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{22cm}{wps-design-flaw-1.png}

\centerline{Pin only, no other means necessary}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{10cm}{wps-design-flaw-2.png}

\centerline{Reminds me of NTLM cracking, crack parts independently}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{18cm}{wps-design-flaw-2-2.png}

\centerline{100.000.000 is a lot, 11.000 is not}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}


\slide{Reaver Rate limiting}

\hlkimage{13cm}{reaver-rate-limiting.png}

\centerline{Make no mistake, it will work!}

\slide{Når adgangen er skabt}

\begin{list1}
\item Så går man igang med de almindelige værktøjer
\item Fyodor Top Network Security Tools \link{http://www.sectools.org}
\end{list1}
\vskip 2 cm

\centerline{\hlkbig Forsvaret er som altid - flere lag af sikkerhed! }

\slide{Infrastrukturændringer}

\hlkimage{13cm}{images/wlan-accesspoint-2.pdf}

\centerline{\hlkbig Sådan bør et access point logisk forbindes til netværket}



\slide{Normal WLAN brug}

\hlkimage{17cm}{images/wlan-airpwn-1.pdf}

\slide{Packet injection - airpwn}

\hlkimage{17cm}{images/wlan-airpwn-2.pdf}

\slide{Airpwn teknikker}

\begin{list1}
\item Klienten sender forespørgsel
\item Hackerens program airpwn lytter og sender så falske pakker
\item Hvordan kan det lade sig gøre?
\begin{list2}
\item Normal forespørgsel og svar på Internet tager 50ms
\item Airpwn kan svare på omkring 1ms angives det
\item Airpwn har alle informationer til rådighed
\end{list2}
\item Airpwn på Defcon 2004 - findes på Sourceforge\\
\link{http://airpwn.sourceforge.net/}
\item NB: Airpwn som demonstreret er begrænset til TCP og ukrypterede
  forbindelser
\end{list1}


\slide{Hjemmenetværk for nørder}

\begin{list1}
\item Lad være med at bruge et wireless-kort i en PC til at lave AP, brug et AP
\item Husk et AP kan være en router, men den kan ofte også blot være en bro
\item Brug WPA og overvej at lave en decideret DMZ til WLAN
\item Placer AP hensigtsmæddigt og gerne højt, oppe på et skab eller lignende
\end{list1}

\slide{Recommendations for wireless networks}

\begin{minipage}{10cm}
\includegraphics[width=10cm]{images/wlan-accesspoint-2.pdf}
\end{minipage}
\begin{minipage}{\linewidth-10cm}
\begin{list2}
\item Use a specific SSID - network name, influences the WPA PSK keying
\item Never use WEP
\item Use WPA PSK or Enterprise, or at least some VPN with individual user logins

\item When using WPA Personal/PSK passphrase must be long, like +40 chars!
\item Place network Access Points on the network where they can be monitored. Separate VLAN, isolated from the cabled LAN
\item Have rules for the use of wireless networks, also for persons travelling - "Always use VPN when using insecure wireless in hotels, airports etc."
\end{list2}
\end{minipage}

\slide{Bonus: Next step, software sikkerhed}

\hlkimage{13cm}{software.pdf}

\centerline{Wireless AP implementerer protokoller med hardware+software}

\slide{Sårbare AP'er - 1}
\begin{list1}
\item Hvordan bygger man et billigt Access Point?
\begin{list2}
\item En embedded kerne
\item En embedded TCP/IP stak
\item Noget 802.11 hardware
\item Et par Ethernet stik
\item eventuelt et modem
\item Tape ...
\end{list2}
\item Hvad med efterfølgende opdatering af software?
\end{list1}

\slide{Sårbare AP'er - 2}
\begin{list1}
\item Eksempler på access point sårbarheder:
\item Konfigurationsfilen kan hentes uden autentificering - inkl. WEP
  nøgler
\item Konfigurationen sker via SNMP - som sender community string i
  klar tekst
\item  Wi-Fi Protected Setup,(WPS) kan ikke slås helt fra
\item ...
\item Konklusionen er klar - hardwaren er i mange tilfælde ikke sikker
  nok til at anvende på forretningskritiske LAN segmenter!
\end{list1}


\slidenext

\end{document}
